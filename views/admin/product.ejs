<div class="main-content">
  <div class="content-header">
      <div>
          <h1>Products</h1>
          <p>Manage all your products here</p>
      </div>
      <button onclick="window.location.href='/admin/product/add'" class="add-product-btn">+ Add product</button>
  </div>

  
  <% if (products.length === 0) { %>
    <p>No products available. Click "+ Add product" to create a new one.</p>
  <% } %>

  <div class="products-grid">
      <!-- Repeat this product card structure -->
      <% products.forEach(product=>{%>
        <div class="product-card">
            <div class="product-image">
                <% if (product.images && product.images.length > 0) { %>
                    <img 
                        src="/img/productsimg/<%= product.images[1] %>" 
                        alt="<%= product.name %>"
                        onerror="this.onerror=null; this.src='/img/default-product.jpg';"
                    >
                <% } else { %>
                    <img 
                        src="/img/default-product.jpg" 
                        alt="<%= product.name %>"
                    >
                <% } %>
            </div>
            <div class="product-info">
                <h3 class="product-name"><%= product.name %></h3>
                <p class="product-price">â‚¹<%= product.price %></p>
                <div class="action-buttons">
                    <button class="edit-btn" onclick="editproduct(event,'<%= product.id %>')">Edit</button>
                    <button class="delete-btn" onclick="deleteProduct('<%=product._id%>')">Delete</button>
                </div>
            </div>
        </div>
      <%})%>
      <!-- Repeat product cards as needed -->
  </div>

  <div class="pagination">
    <% if (page > 1) { %>
        <a href="?page=<%= page - 1 %>" class="page-link"><</a>
    <% } %>

    <% for (let i = 1; i <= totalPages; i++) { %>
        <a href="?page=<%= i %>" class="page-link <%= i === page ? 'active' : '' %>">
            <%= i %>
        </a>
    <% } %>

    <% if (page < totalPages) { %>
        <a href="?page=<%= page + 1 %>" class="page-link">></a>
    <% } %>
</div>

</div>
<script>
    function editproduct(event,productId)
    {
        event.preventDefault();

        fetch('/admin/product/edit/${productId}',{
            method:"GET"
        })
        .then((response)=>
        {
        if(response.ok)
        {
           window.location.href="/admin/product/edit";
        }else
        {
            alert("edit not possible");
        }
       })
       .catch(error=>{
         console.error("Error during edit",error)
       })
    }

    function deleteProduct(productId) {
    if (confirm('Are you sure you want to delete this product?')) {
        fetch(`/admin/product/delete/${productId}`, {
            method: 'DELETE',
        })
        .then((response) => {
            if (response.ok) {
                alert('Product soft-deleted successfully');
                location.reload();
            } else {
                alert('Failed to delete the product');
            }
        })
        .catch((error) => {
            console.error('Error during soft delete:', error);
        });
    }
}

</script>